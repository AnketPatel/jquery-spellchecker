/*
 * jQuery Spellchecker - v0.1.0 - 2012-10-13
 * https://github.com/badsyntax/jquery-spellchecker
 * Copyright (c) 2012 Richard Willis; Licensed MIT
 */
(function(e){var t={engine:{lang:"en",type:"PSpell",path:"checkspelling.php"},local:{requestError:"There was an error processing the request.",ignoreWord:"Ignore word",ignoreAll:"Ignore all",ignoreForever:"Add to dictionary",loading:"Loading..."},suggestBox:{numWords:5,position:"above"},incorrectWords:{container:"body"}};Function.prototype.bind||(Function.prototype.bind=function(t){return e.proxy(this,t)});var n=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},r=function(){this.handlers={}};r.prototype={on:function(e,t){this.handlers[e]?this.handlers[e].push(t):this.handlers[e]=[t]},trigger:function(t){var n=this.handlers[t];if(!this.handlers)return;var r=Array.prototype.slice.call(arguments,1);e.each(n,function(e,t){t.apply(this,r)}.bind(this))},handler:function(e){return function(t){this.trigger(e,t)}.bind(this)}};var i=function(e){r.call(this),this.config=e,this.createBox(),this.bindEvents()};n(i,r),i.prototype.onSelectWord=function(t){t.stopPropagation();var n=e(t.currentTarget),r=e.trim(n.text());this.trigger("select.word",t,r,n)};var s=function(e){i.apply(this,arguments)};n(s,i),s.prototype.bindEvents=function(){this.container.on("click","a",this.onSelectWord.bind(this))},s.prototype.createBox=function(){this.container=e(['<div class="spellchecker-incorrectwords">',"</div>"].join("")).appendTo(this.config.incorrectWords.container)},s.prototype.addWords=function(t){var n=e.map(t,function(e){return'<a href="#">'+e+"</a>"}).join("");this.container.html(n).show()};var o=function(e){i.apply(this,arguments)};n(o,i),o.prototype.bindEvents=function(){this.container.on("click",this.onContainerClick.bind(this)),e("html").on("click.spellchecker",this.onWindowClick.bind(this)),this.container.on("click.spellchecker",".ignore-word",this.handler("ignore.word")),this.container.on("click.spellchecker",".ignore-all",this.handler("ignore.all")),this.container.on("click.spellchecker",".ignore-forever",this.handler("ignore.forever")),this.container.on("click.spellchecker",".spellchecker-suggestbox-words a",this.onSelectWord.bind(this))},o.prototype.createBox=function(){var t=this.config.local;this.container=e(['<div class="spellchecker-suggestbox">',' <div class="spellchecker-suggestbox-footer">','   <a href="#" class="ignore-word">'+t.ignoreWord+"</a>",'   <a href="#" class="ignore-all">'+t.ignoreAll+"</a>",'   <a href="#" class="ignore-forever">'+t.ignoreForever+"</a>"," </div>","</div>"].join("")).appendTo("body"),this.words=e(['<div class="spellchecker-suggestbox-words">',"</div>"].join("")).prependTo(this.container),this.loading=e(['<div class="loading">',this.config.local.loading,"</div>"].join("")),this.footer=this.container.find(".spellchecker-suggestbox-footer").hide()},o.prototype.addWords=function(t){var n=e.map(t,function(e){return'<a href="#">'+e+"</a>"}).slice(0,this.config.suggestBox.numWords).join("");n||(n="<em>(No suggestions)</em>"),this.words.html(n)},o.prototype.loadSuggestedWords=function(e,t,n){this.wordElement=n,this.load(!0),this.position(n),e(t,this.onGetWords.bind(this))},o.prototype.load=function(e){this.open(),this.words.html(e?this.loading:"")},o.prototype.position=function(t){t=e(t);var n=t.offset(),r=n.left,i=n.top-this.container.height()+"px",s=n.top+t.outerHeight(),o=this.config.suggestBox.position==="above"?i:s;this.container.css({top:o,left:r})},o.prototype.open=function(){this.container.fadeIn(100)},o.prototype.close=function(){this.container.fadeOut(100)},o.prototype.onGetWords=function(e){this.load(!1),this.addWords(e),this.footer.show(),this.position(this.wordElement)},o.prototype.onContainerClick=function(e){e.stopPropagation()},o.prototype.onWindowClick=function(e){this.close()};var u=function(e){this.config=e,this.defaultConfig={url:this.config.engine.path,type:"POST",dataType:"json",cache:!1,data:{lang:this.config.engine.lang,engine:this.config.engine.type},error:function(){alert(this.config.local.requestError)}.bind(this)}};u.prototype.makeRequest=function(t){var n=e.extend(!0,{},this.defaultConfig);return e.ajax(e.extend(!0,n,t))},u.prototype.checkWords=function(e,t){return this.makeRequest({data:{text:e},success:t})},u.prototype.getSuggestedWords=function(e,t){return this.makeRequest({data:{suggest:e},success:t})};var a={};a.PSpell=function(e,t){u.apply(this,arguments)},n(a.PSpell,u);var f=function(n,i){r.call(this),this.element=e(n),this.config=e.extend(!0,t,i),this.setupEngine(),this.setupSuggestBox(),this.setupIncorrectWordsBox(),this.bindEvents()};n(f,r),f.prototype.setupEngine=function(){this.engine=new a[this.config.engine.type](this.config)},f.prototype.setupSuggestBox=function(){this.suggestBox=new o(this.config)},f.prototype.setupIncorrectWordsBox=function(){this.incorrectWordsBox=new s(this.config)},f.prototype.bindEvents=function(){this.on("check.success",this.onCheckSuccess.bind(this)),this.on("check.fail",this.onCheckFail.bind(this)),this.suggestBox.on("ignore.word",this.onIgnoreWord.bind(this)),this.suggestBox.on("ignore.all",this.onIgnoreAll.bind(this)),this.suggestBox.on("ignore.forever",this.onIgnoreForever.bind(this)),this.suggestBox.on("select.word",this.onSuggestedWordSelect.bind(this)),this.incorrectWordsBox.on("select.word",this.onIncorrectWordSelect.bind(this))},f.prototype.getWordsFromText=function(t){var n="<[^>]+>",r="^[^a-zA-Z\\u00A1-\\uFFFF]|[^a-zA-Z\\u00A1-\\uFFFF]+[^a-zA-Z\\u00A1-\\uFFFF]|[^a-zA-Z\\u00A1-\\uFFFF]$|\\n|\\t|\\s{2,}";return t=e.trim(t),t=t.replace(new RegExp(n,"g"),""),t=t.replace(new RegExp(r,"g")," "),t},f.prototype.check=function(){var e=this.element.val(),t=this.getWordsFromText(e);this.engine.checkWords(t,this.onCheckWords.bind(this))},f.prototype.showSuggestedWords=function(e,t){var n=this.engine.getSuggestedWords.bind(this.engine);this.suggestBox.loadSuggestedWords(n,e,t)},f.prototype.replaceWordInText=function(e,t,n){return e.replace(new RegExp("([^a-zA-Z\\u00A1-\\uFFFF]?)("+t+")([^a-zA-Z\\u00A1-\\uFFFF]?)","g"),"$1"+n+"$3").replace(new RegExp("^("+t+")([^a-zA-Z\\u00A1-\\uFFFF])","g"),n+"$2").replace(new RegExp("([^a-zA-Z\\u00A1-\\uFFFF])("+t+")$","g"),"$1"+n)},f.prototype.replaceWord=function(e){var t=this.element.val(),n=this.badWord,r=this.replaceWordInText(t,n,e);this.element.val(r)},f.prototype.onCheckWords=function(e){var t=e.data,n=t.length?"fail":"success";this.trigger("check."+n,t)},f.prototype.onCheckSuccess=function(){},f.prototype.onCheckFail=function(e){this.incorrectWordsBox.addWords(e)},f.prototype.onSuggestedWordSelect=function(e,t,n){e.preventDefault(),this.replaceWord(t,n),this.suggestBox.close()},f.prototype.onIgnoreWord=function(){alert("Ignore word")},f.prototype.onIgnoreAll=function(){alert("Ignore all")},f.prototype.onIgnoreForever=function(){alert("Ignore forever")},f.prototype.onIncorrectWordSelect=function(e,t,n){e.preventDefault(),this.badWord=t,this.showSuggestedWords(t,n)},e.SpellChecker=f})(jQuery);